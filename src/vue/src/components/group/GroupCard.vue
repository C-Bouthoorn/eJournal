<template>
    <b-card class="no-hover">
        <h2 class="mb-2">Group: {{ groupName }}</h2>
            <b-form v-if="$hasPermission('can_edit_course_user_group')" @submit.prevent="updateGroupName">
                <b-input class="multi-form theme-input" v-model="form.newGroupName" placeholder="Update group name" required/>
                <b-button class="float-right add-button" type="submit">
                    <icon name="plus-square"/>
                    Update
                </b-button>
            </b-form>
            <b-button v-if="$hasPermission('can_delete_course_user_group')" class="float-left delete-button" @click.prevent.stop="removeGroup()">
                <icon name="trash"/>
                Remove group
            </b-button>
    </b-card>
</template>

<script>
import icon from 'vue-awesome/components/Icon'
import groupAPI from '@/api/group'
import escapeHtml from '@/utils/escape.js'

export default {
    props: {
        cID: {
            required: true
        },
        group: {
            required: true
        }
    },
    data () {
        return {
            groupName: '',
            form: {
                newGroupName: ''
            }
        }
    },
    methods: {
        updateGroupName () {
            groupAPI.update(this.cID, {
                old_group_name: this.group,
                new_group_name: this.form.newGroupName
            })
                .then(group => {
                    this.groupName = this.form.newGroupName
                    this.$emit('update-group', this.groupName, group.name)
                    this.$toasted.success('Successfully updated the group.')
                    this.form.newGroupName = ''
                })
                .catch(error => { this.$toasted.error(escapeHtml(error.response.data.description)) })
        },
        removeGroup () {
            if (confirm('Are you sure you want to remove "' + this.groupName + '" from this course?')) {
                groupAPI.delete(this.cID, this.groupName).then(data => {
                    this.$toasted.success(escapeHtml(data.description))
                    this.$emit('delete-group', this.groupName)
                }, error => {
                    this.$toasted.error(escapeHtml(error.response.data.description))
                })
            }
        }
    },
    created () {
        this.groupName = this.group
    },
    components: {
        'icon': icon
    }
}
</script>
